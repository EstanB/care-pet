

<!DOCTYPE html>
<html class="no-js" lang="en">

  <head>
    <meta charset="utf-8" />
    <meta name="viewport" content="width=device-width initial-scale=1" />
    <meta http-equiv="X-UA-Compatible" content="IE=edge" />
    <title> Getting Started with CarePet: A sample IoT App | Scylla Docs
    </title>
    <meta name="description" content="ScyllaDB IoT Example Documentation" />
    <link
      rel="icon"
      href="_static/img/favicon.ico"
      type="image/x-icon"
    />
    <link
      rel="icon"
      href="_static/img/favicon-32x32.png"
      sizes="32x32"
    />
    <link
      rel="icon"
      href="_static/img/favicon-228x228.png"
      sizes="192x192"
    />
    <link
      rel="apple-touch-icon"
      href="_static/img/favicon-228x228.png"
    />
    <meta
      name="msapplication-TileImage"
      href="_static/img/favicon-228x228.png"
    />
    <link rel="canonical" href="https://docs.scylladb.com/" />
    <link rel="author" href="mailto:info@scylladb.com" />
  <!-- connect to domain of font files -->
  <link rel="preconnect" href="https://fonts.gstatic.com" crossorigin />

  <!-- optionally increase loading priority -->
  <link
    rel="preload"
    as="style"
    href="https://fonts.googleapis.com/css2?family=Roboto:ital,wght@0,400;0,500;0,700;1,400&display=swap"
  />

  <!-- async CSS -->
  <link
    rel="stylesheet"
    media="print"
    onload="this.onload=null;this.removeAttribute('media');"
    href="https://fonts.googleapis.com/css2?family=Roboto:ital,wght@0,400;0,500;0,700;1,400&display=swap"
  />

  <!-- no-JS fallback -->
  <noscript>
    <link
      rel="stylesheet"
      href="https://fonts.googleapis.com/css2?family=Roboto:ital,wght@0,400;0,500;0,700;1,400&display=swap"
    />
  </noscript>
  <link
    rel="stylesheet"
    href="_static/css/main.css"
    type="text/css"
  />
  <link
    rel="stylesheet"
    href="_static/pygments.css"
    type="text/css"
  /> <link rel="stylesheet" type="text/css" href="_static/copybutton.css" />

  <script
    type="text/javascript"
    id="documentation_options"
    data-url_root="./"
    src="_static/documentation_options.js"
  ></script>
  <script
    type="text/javascript"
    src="_static/js/runtime.bundle.js"
  ></script>
  <script
    type="text/javascript"
    src="_static/js/main.bundle.js"
  ></script> <script src="_static/jquery.js"></script> <script src="_static/underscore.js"></script> <script src="_static/doctools.js"></script> <script src="_static/language_data.js"></script> <script src="_static/clipboard.min.js"></script> <script src="_static/copybutton.js"></script>

    <!-- Google Tag Manager -->
    <script>
      (function (w, d, s, l, i) {
        w[l] = w[l] || [];
        w[l].push({ "gtm.start": new Date().getTime(), event: "gtm.js" });
        var f = d.getElementsByTagName(s)[0],
          j = d.createElement(s),
          dl = l != "dataLayer" ? "&l=" + l : "";
        j.async = true;
        j.src = "https://www.googletagmanager.com/gtm.js?id=" + i + dl;
        f.parentNode.insertBefore(j, f);
      })(window, document, "script", "dataLayer", "GTM-T8P2JP");
    </script>
    <!-- End Google Tag Manager -->
    <!-- Marketo -->
    <script type="text/javascript">
      (function () {
        var didInit = false;
        function initMunchkin() {
          if (didInit === false) {
            didInit = true;
            Munchkin.init("791-QBF-350");
          }
        }
        var s = document.createElement("script");
        s.type = "text/javascript";
        s.async = true;
        s.src = "//munchkin.marketo.net/munchkin.js";
        s.onreadystatechange = function () {
          if (this.readyState == "complete" || this.readyState == "loaded") {
            initMunchkin();
          }
        };
        s.onload = initMunchkin;
        document.getElementsByTagName("head")[0].appendChild(s);
      })();
    </script>
    <!-- End Marketo -->
    <!-- Expertrec -->
    <script>
      var id = "e2077224-9ccf-11e9-a0c9-0242ac130002";
      var ci_search = document.createElement("script");
      ci_search.type = "text/javascript";
      ci_search.async = true;
      ci_search.src = "https://cse.expertrec.com/api/js/ci_common.js?id=" + id;
      var s = document.getElementsByTagName("script")[0];
      s.parentNode.insertBefore(ci_search, s);
    </script>
    <!-- End Expertrec -->

    <!-- Font Awesome -->
    <script
      src="https://kit.fontawesome.com/b1870adf6a.js"
      crossorigin="anonymous"
    ></script>
    <!-- End Font Awesome -->
  </head>
  
  <body>
     <header class="header">
  <div class="header-logo">
    <a class="header-logo__img" href="https://scylladb.com/">
      <img
        src="_static/img/logo-scylla-docs.svg"
        alt="Scylla Documentation Logo"
      />
    </a>
    <span class="header-logo__bar"></span>
    <a class="header-logo__text" href="https://docs.scylladb.com/">
      Documentation
    </a>
  </div>
  <div class="header-navigation">
    <ul
      class="dropdown menu scylla-dropdown scylla-dropdown--header"
      data-dropdown-menu
    >
      <li class="scylla-dropdown__item">
        <a href="#" class="scylla-dropdown__title"
          >Server <i class="chevron scylla-icon scylla-icon--triangle-down"></i
        ></a>
        <ul class="menu scylla-dropdown__content">
          <li>
            <a href="https://docs.scylladb.com/"
              ><i class="scylla-icon scylla-icon--about-us"></i>Scylla Open
              Source</a
            >
          </li>
          <li>
            <a href="https://docs.scylladb.com/"
              ><i class="scylla-icon scylla-icon--enterprise"></i>Scylla
              Enterprise</a
            >
          </li>
          <li>
            <a
              href="https://scylla.docs.scylladb.com/master/alternator/alternator.html"
            >
              <i class="scylla-icon scylla-icon--overview"></i>Scylla
              Alternator</a
            >
          </li>
        </ul>
      </li>
      <li class="scylla-dropdown__item">
        <a href="#" class="scylla-dropdown__title"
          >Cloud <i class="chevron scylla-icon scylla-icon--triangle-down"></i
        ></a>
        <ul class="menu scylla-dropdown__content">
          <li>
            <a href="https://cloud.scylladb.com/">
              <i class="scylla-icon scylla-icon--cloud"></i>Scylla Cloud</a
            >
          </li>
          <li>
            <a href="https://docs.scylladb.com/scylla-cloud/">
              <i class="scylla-icon scylla-icon--cloud-docs"></i>Scylla Cloud
              Docs</a
            >
          </li>
        </ul>
      </li>
      <li class="scylla-dropdown__item">
        <a href="#" class="scylla-dropdown__title"
          >Tools <i class="chevron scylla-icon scylla-icon--triangle-down"></i
        ></a>
        <ul class="menu scylla-dropdown__content">
          <li>
            <a href="https://manager.docs.scylladb.com/">
              <i class="scylla-icon scylla-icon--manager"></i>Scylla Manager</a
            >
          </li>
          <li>
            <a href="https://monitoring.docs.scylladb.com/">
              <i class="scylla-icon scylla-icon--monitoring"></i>Scylla
              Monitoring Stack</a
            >
          </li>
          <li>
            <a href="https://operator.docs.scylladb.com/">
              <i class="scylla-icon scylla-icon--operator"></i>Scylla Operator
            </a>
          </li>
        </ul>
      </li>
      <li class="scylla-dropdown__item">
        <a href="#" class="scylla-dropdown__title"
          >Drivers <i class="chevron scylla-icon scylla-icon--triangle-down"></i
        ></a>
        <ul class="menu scylla-dropdown__content">
          <li>
            <a
              href="https://docs.scylladb.com/using-scylla/drivers/cql-drivers/"
            >
              <i class="scylla-icon scylla-icon--nsql-guides"></i>CQL Drivers
            </a>
          </li>
          <li>
            <a
              href="https://docs.scylladb.com/using-scylla/drivers/dynamo-drivers/"
            >
              <i class="scylla-icon scylla-icon--overview"></i>DynamoDB Drivers
            </a>
          </li>
        </ul>
      </li>
    </ul>
    <div class="header-button">
      <a href="https://www.scylladb.com/download/" class="button">Download</a>
    </div>
  </div>
  <div class="header-search-box">
    <div class="search-box">
      <ci-search></ci-search>
    </div>
  </div>
  <div class="side-nav-toggle" data-toggle="side-nav">
  <div class="side-nav-toggle__button">
    <img src="_static/img/menu.svg" alt="Menu" />
  </div>
</div>
</header>
    <section class="layout ">
      <div class="content large-order-2">
         

        <div class="pre-content">
          <div class="pre-content__left"><div class="breadcrumbs">
  <span class="bread__item"
    ><a href="index.html" class="icon icon-home">Home</a></span
  >
  
  <span class="bread__item bread__item--last">Getting Started with CarePet: A sample IoT App</span>
</div></div>
          <div class="pre-content__right"><ul
  class="dropdown menu scylla-dropdown scylla-dropdown--contribute"
  data-dropdown-menu
>
  <li class="scylla-dropdown__item">
    <a class="scylla-dropdown__title" href="#">
      <div class="scylla-dropdown__title--body">
        <i class="icon fa fa-github" aria-hidden="true"></i>
        Contribute
      </div>
      <i class="chevron scylla-icon scylla-icon--chevron-right"></i>
    </a>
    <ul class="menu scylla-dropdown__content">
      <li>
        <a
          href="https://github.com/scylladb/care-pet/issues/new?title=Issue in page Getting Started with CarePet: A sample IoT App&&body=I%20would%20like%20to%20report%20an%20issue%20in%20page%20https://care-pet.docs.scylladb.com/master/getting_started%0A%0A%23%23%23%20Problem%0A%0A%23%23%23%20%20Suggest%20a%20fix"
          target="_blank"
          >Report a doc issue
          <i class="icon fa fa-external-link" aria-hidden="true"></i
        ></a>
      </li>
      
      <li>
             
        <a
          href="https://github.com/scylladb/care-pet/edit/master/docs/getting_started.md"
          target="_blank"
          >Edit this page
          <i class="icon fa fa-external-link" aria-hidden="true"></i
        ></a>
      </li>
      
      <li>
        <a href="https://docs.scylladb.com/contribute/" target="_blank"
          >Learn how to contribute
          <i class="icon fa fa-external-link" aria-hidden="true"></i
        ></a>
      </li>
    </ul>
  </li>
</ul></div>
        </div>
         <div class="section" id="getting-started-with-carepet-a-sample-iot-app">
<h1>Getting Started with CarePet: A sample IoT App<a class="headerlink" href="#getting-started-with-carepet-a-sample-iot-app" title="Permalink to this headline">¶</a></h1>
<div class="section" id="introduction">
<h2>Introduction<a class="headerlink" href="#introduction" title="Permalink to this headline">¶</a></h2>
<p>In this guided exercise, you’ll create an IoT app from scratch and configure it
to use ScyllaDB as the backend datastore.</p>
<p>We’ll use as an example, an application called CarePet, which collects and
analyzes data from sensors attached to a pet’s collar and monitors the pet’s
health and activity.</p>
<p>The example can be used, with minimal changes, for any IoT like application.</p>
<p>We’ll go over the different stages of the development, from gathering
requirements, creating the data model, cluster sizing and hardware needed to
match the requirements, and finally building and running the application.</p>
</div>
<div class="section" id="use-case-requirements">
<h2>Use Case Requirements<a class="headerlink" href="#use-case-requirements" title="Permalink to this headline">¶</a></h2>
<p>Each pet collar includes sensors that report four different measurements:
Temperature, Pulse, Location, and Respiration.</p>
<p>The collar reads the sensor’s data once a second and sends measurements
directly to the app.</p>
</div>
<div class="section" id="performance-requirements">
<h2>Performance Requirements<a class="headerlink" href="#performance-requirements" title="Permalink to this headline">¶</a></h2>
<p>The application has two parts:</p>
<ul class="simple">
<li><p>Sensors: writes to the database, throughput sensitive</p></li>
<li><p>Backend dashboard: reads from the database, latency-sensitive</p></li>
</ul>
<p>For this example, we assume 99% writes (sensors) and 1% reads (backend dashboard)</p>
<p>Required SLA:</p>
<ul class="simple">
<li><p>Writes throughput of 100K Operations per second</p></li>
<li><p>Reads: latency of up to 10 milliseconds for the
<a class="reference external" href="https://engineering.linkedin.com/performance/who-moved-my-99th-percentile-latency">99th percentile</a>.</p></li>
</ul>
<p>The application requires high availability and fault tolerance. Even if a
ScyllaDB node goes down or becomes unavailable, the cluster is expected to
remain available and continue to provide service. You can learn more about
Scylla high availability in <a class="reference external" href="https://university.scylladb.com/courses/scylla-essentials-overview/lessons/high-availability/">this lesson</a>.</p>
</div>
<div class="section" id="design-and-data-model">
<h2>Design and Data Model<a class="headerlink" href="#design-and-data-model" title="Permalink to this headline">¶</a></h2>
<p>In this part  we’ll think about our queries, make the primary key and
clustering key selection, and create the database schema. See more in the data
model design <a class="reference internal" href="design_and_data_model.html"><span class="doc">document</span></a>.</p>
</div>
<div class="section" id="deploying-the-app">
<h2>Deploying the App<a class="headerlink" href="#deploying-the-app" title="Permalink to this headline">¶</a></h2>
<p>Prerequisites:</p>
<ul class="simple">
<li><p><a class="reference external" href="https://golang.org/dl/">go</a>, version 1.14 or newer</p></li>
<li><p><a class="reference external" href="https://www.docker.com/">docker</a></p></li>
<li><p><a class="reference external" href="https://docs.docker.com/compose/">docker-compose</a></p></li>
</ul>
<p>The example application uses Docker to run a three-node ScyllaDB cluster. It
allows tracking of pet’s health indicators and consists of three parts:</p>
<ul class="simple">
<li><p>migrate (/cmd/migrate) - creates the CarePet keyspace and tables</p></li>
<li><p>collar (/cmd/sensor) - generates a pet health data and pushes it into the
storage</p></li>
<li><p>web app (/cmd/server) - REST API service for tracking the pets’ health
state</p></li>
</ul>
<p>Download the example code from git:</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span>$ git clone git@github.com:scylladb/care-pet.git
</pre></div>
</div>
<p>Start by creating a local ScyllaDB cluster consisting of 3 nodes:</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span>$ docker-compose up -d
</pre></div>
</div>
<p>Docker-compose will spin up a ScyllaDB cluster consisting of 3 nodes: carepet-scylla1, carepet-scylla2 and carepet-scylla3.  Wait for about two minutes and check the status of the cluster:
To check the status of the cluster:</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span>$ docker exec -it carepet-scylla1 nodetool status
</pre></div>
</div>
<p>Once all the nodes are in UN - Up Normal status, initialize the database. This will create the keyspaces and tables:</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span>$ go build ./cmd/migrate
$ NODE1=$(docker inspect -f &#39;{{range .NetworkSettings.Networks}}{{.IPAddress}}{{end}}&#39; carepet-scylla1)
$ ./migrate --hosts $NODE1
</pre></div>
</div>
<p>expected output:</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="mi">2020</span><span class="o">/</span><span class="mi">08</span><span class="o">/</span><span class="mi">06</span> <span class="mi">16</span><span class="p">:</span><span class="mi">43</span><span class="p">:</span><span class="mi">01</span> <span class="n">Bootstrap</span> <span class="n">database</span><span class="o">...</span>
<span class="mi">2020</span><span class="o">/</span><span class="mi">08</span><span class="o">/</span><span class="mi">06</span> <span class="mi">16</span><span class="p">:</span><span class="mi">43</span><span class="p">:</span><span class="mi">13</span> <span class="n">Keyspace</span> <span class="n">metadata</span> <span class="o">=</span> <span class="p">{</span><span class="n">Name</span><span class="p">:</span><span class="n">carepet</span> <span class="n">DurableWrites</span><span class="p">:</span><span class="n">true</span> <span class="n">StrategyClass</span><span class="p">:</span><span class="n">org</span><span class="o">.</span><span class="n">apache</span><span class="o">.</span><span class="n">cassandra</span><span class="o">.</span><span class="n">locator</span><span class="o">.</span><span class="n">NetworkTopologyStrategy</span> <span class="n">StrategyOptions</span><span class="p">:</span><span class="nb">map</span><span class="p">[</span><span class="n">datacenter1</span><span class="p">:</span><span class="mi">3</span><span class="p">]</span> <span class="n">Tables</span><span class="p">:</span><span class="nb">map</span><span class="p">[</span><span class="n">gocqlx_migrate</span><span class="p">:</span><span class="mh">0xc00016ca80</span> <span class="n">measurement</span><span class="p">:</span><span class="mh">0xc00016cbb0</span> <span class="n">owner</span><span class="p">:</span><span class="mh">0xc00016cce0</span> <span class="n">pet</span><span class="p">:</span><span class="mh">0xc00016ce10</span> <span class="n">sensor</span><span class="p">:</span><span class="mh">0xc00016cf40</span> <span class="n">sensor_avg</span><span class="p">:</span><span class="mh">0xc00016d070</span><span class="p">]</span> <span class="n">Functions</span><span class="p">:</span><span class="nb">map</span><span class="p">[]</span> <span class="n">Aggregates</span><span class="p">:</span><span class="nb">map</span><span class="p">[]</span> <span class="n">Types</span><span class="p">:</span><span class="nb">map</span><span class="p">[]</span> <span class="n">Indexes</span><span class="p">:</span><span class="nb">map</span><span class="p">[]</span> <span class="n">Views</span><span class="p">:</span><span class="nb">map</span><span class="p">[]}</span>
</pre></div>
</div>
<p>You can check the database structure with:</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span>   $ docker exec -it carepet-scylla1 cqlsh
   
   cqlsh&gt; DESCRIBE KEYSPACES
   carepet  system_schema  system_auth  system  system_distributed  system_traces

   cqlsh&gt; USE carepet;
   cqlsh:carepet&gt; DESCRIBE TABLES
   pet  sensor_avg  gocqlx_migrate  measurement  owner  sensor

   cqlsh:carepet&gt; DESCRIBE TABLE pet

   CREATE TABLE carepet.pet (
       owner_id uuid,
       pet_id uuid,
       address text,
       age int,
       name text,
       weight float,
       PRIMARY KEY (owner_id, pet_id)
   ) WITH CLUSTERING ORDER BY (pet_id ASC)
       AND bloom_filter_fp_chance = 0.01
       AND caching = {&#39;keys&#39;: &#39;ALL&#39;, &#39;rows_per_partition&#39;: &#39;ALL&#39;}
       AND comment = &#39;&#39;
       AND compaction = {&#39;class&#39;: &#39;SizeTieredCompactionStrategy&#39;}
       AND compression = {&#39;sstable_compression&#39;: &#39;org.apache.cassandra.io.compress.LZ4Compressor&#39;}
       AND crc_check_chance = 1.0
       AND dclocal_read_repair_chance = 0.1
       AND default_time_to_live = 0
       AND gc_grace_seconds = 864000
       AND max_index_interval = 2048
       AND memtable_flush_period_in_ms = 0
       AND min_index_interval = 128
       AND read_repair_chance = 0.0
       AND speculative_retry = &#39;99.0PERCENTILE&#39;;

   cqlsh:carepet&gt; exit
</pre></div>
</div>
<p>Next, start the pet collar simulation. From a separate terminal execute the following command to generate the pet’s health data and save it to the database:</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span>$ go build ./cmd/sensor
$ NODE1=$(docker inspect -f &#39;{{range .NetworkSettings.Networks}}{{.IPAddress}}{{end}}&#39; carepet-scylla1)
$ ./sensor --hosts $NODE1
</pre></div>
</div>
<p>expected output:</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="mi">2020</span><span class="o">/</span><span class="mi">08</span><span class="o">/</span><span class="mi">06</span> <span class="mi">16</span><span class="p">:</span><span class="mi">44</span><span class="p">:</span><span class="mi">33</span> <span class="n">Welcome</span> <span class="n">to</span> <span class="n">the</span> <span class="n">Pet</span> <span class="n">collar</span> <span class="n">simulator</span>
<span class="mi">2020</span><span class="o">/</span><span class="mi">08</span><span class="o">/</span><span class="mi">06</span> <span class="mi">16</span><span class="p">:</span><span class="mi">44</span><span class="p">:</span><span class="mi">33</span> <span class="n">New</span> <span class="n">owner</span> <span class="c1"># 9b20764b-f947-45bb-a020-bf6d02cc2224</span>
<span class="mi">2020</span><span class="o">/</span><span class="mi">08</span><span class="o">/</span><span class="mi">06</span> <span class="mi">16</span><span class="p">:</span><span class="mi">44</span><span class="p">:</span><span class="mi">33</span> <span class="n">New</span> <span class="n">pet</span> <span class="c1"># f3a836c7-ec64-44c3-b66f-0abe9ad2befd</span>
<span class="mi">2020</span><span class="o">/</span><span class="mi">08</span><span class="o">/</span><span class="mi">06</span> <span class="mi">16</span><span class="p">:</span><span class="mi">44</span><span class="p">:</span><span class="mi">33</span> <span class="n">sensor</span> <span class="c1"># 48212af8-afff-43ea-9240-c0e5458d82c1 type L new measure 51.360596 ts 2020-08-06T16:44:33+02:00</span>
<span class="mi">2020</span><span class="o">/</span><span class="mi">08</span><span class="o">/</span><span class="mi">06</span> <span class="mi">16</span><span class="p">:</span><span class="mi">44</span><span class="p">:</span><span class="mi">33</span> <span class="n">sensor</span> <span class="c1"># 2ff06ffb-ecad-4c55-be78-0a3d413231d9 type R new measure 36 ts 2020-08-06T16:44:33+02:00</span>
<span class="mi">2020</span><span class="o">/</span><span class="mi">08</span><span class="o">/</span><span class="mi">06</span> <span class="mi">16</span><span class="p">:</span><span class="mi">44</span><span class="p">:</span><span class="mi">33</span> <span class="n">sensor</span> <span class="c1"># 821588e0-840d-48c6-b9c9-7d1045e0f38c type L new measure 26.380281 ts 2020-08-06T16:44:33+02:00</span>
<span class="o">...</span>
</pre></div>
</div>
<p>Write down the pet Owner ID (the ID is the part after the # sign without trailing spaces). We will use it later.
Now, start the REST API service in a separate, third, terminal. This server exposes a REST API that allows for tracking the pet’s health state:</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span>$ go build ./cmd/server
$ NODE1=$(docker inspect -f &#39;{{range .NetworkSettings.Networks}}{{.IPAddress}}{{end}}&#39; carepet-scylla1)
$ ./server --port 8000 --hosts $NODE1
</pre></div>
</div>
<p>expected output:</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="mi">2020</span><span class="o">/</span><span class="mi">08</span><span class="o">/</span><span class="mi">06</span> <span class="mi">16</span><span class="p">:</span><span class="mi">45</span><span class="p">:</span><span class="mi">58</span> <span class="n">Serving</span> <span class="n">care</span> <span class="n">pet</span> <span class="n">at</span> <span class="n">http</span><span class="p">:</span><span class="o">//</span><span class="mf">127.0</span><span class="o">.</span><span class="mf">0.1</span><span class="p">:</span><span class="mi">8000</span>
</pre></div>
</div>
</div>
<div class="section" id="using-the-application">
<h2>Using the Application<a class="headerlink" href="#using-the-application" title="Permalink to this headline">¶</a></h2>
<p>Open http://127.0.0.1:8000/ in a browser or send an HTTP request from the CLI:</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span>$ curl -v http://127.0.0.1:8000/
</pre></div>
</div>
<p>expected output:</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="o">&gt;</span> <span class="n">GET</span> <span class="o">/</span> <span class="n">HTTP</span><span class="o">/</span><span class="mf">1.1</span>
<span class="o">&gt;</span> <span class="n">Host</span><span class="p">:</span> <span class="mf">127.0</span><span class="o">.</span><span class="mf">0.1</span><span class="p">:</span><span class="mi">8000</span>
<span class="o">&gt;</span> <span class="n">User</span><span class="o">-</span><span class="n">Agent</span><span class="p">:</span> <span class="n">curl</span><span class="o">/</span><span class="mf">7.71</span><span class="o">.</span><span class="mi">1</span>
<span class="o">&gt;</span> <span class="n">Accept</span><span class="p">:</span> <span class="o">*/*</span>
<span class="o">&gt;</span> 
<span class="o">*</span> <span class="n">Mark</span> <span class="n">bundle</span> <span class="k">as</span> <span class="ow">not</span> <span class="n">supporting</span> <span class="n">multiuse</span>
<span class="o">&lt;</span> <span class="n">HTTP</span><span class="o">/</span><span class="mf">1.1</span> <span class="mi">404</span> <span class="n">Not</span> <span class="n">Found</span>
<span class="o">&lt;</span> <span class="n">Content</span><span class="o">-</span><span class="n">Type</span><span class="p">:</span> <span class="n">application</span><span class="o">/</span><span class="n">json</span>
<span class="o">&lt;</span> <span class="n">Date</span><span class="p">:</span> <span class="n">Thu</span><span class="p">,</span> <span class="mi">06</span> <span class="n">Aug</span> <span class="mi">2020</span> <span class="mi">14</span><span class="p">:</span><span class="mi">47</span><span class="p">:</span><span class="mi">41</span> <span class="n">GMT</span>
<span class="o">&lt;</span> <span class="n">Content</span><span class="o">-</span><span class="n">Length</span><span class="p">:</span> <span class="mi">45</span>
<span class="o">&lt;</span> <span class="n">Connection</span><span class="p">:</span> <span class="n">close</span>
<span class="o">&lt;</span> 
<span class="o">*</span> <span class="n">Closing</span> <span class="n">connection</span> <span class="mi">0</span>
<span class="p">{</span><span class="s2">&quot;code&quot;</span><span class="p">:</span><span class="mi">404</span><span class="p">,</span><span class="s2">&quot;message&quot;</span><span class="p">:</span><span class="s2">&quot;path / was not found&quot;</span><span class="p">}</span>
</pre></div>
</div>
<p>If you see this JSON in the end with 404, it means everything works as
expected. To read an owner’s data use the previously saved owner_id as follows:</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span>$ curl -v http://127.0.0.1:8000/api/owner/{owner_id}
</pre></div>
</div>
<p>for example:</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span>$ curl http://127.0.0.1:8000/api/owner/a05fd0df-0f97-4eec-a211-cad28a6e5360
</pre></div>
</div>
<p>expected result:</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="p">{</span><span class="s2">&quot;address&quot;</span><span class="p">:</span><span class="s2">&quot;home&quot;</span><span class="p">,</span><span class="s2">&quot;name&quot;</span><span class="p">:</span><span class="s2">&quot;gmwjgsap&quot;</span><span class="p">,</span><span class="s2">&quot;owner_id&quot;</span><span class="p">:</span><span class="s2">&quot;a05fd0df-0f97-4eec-a211-cad28a6e5360&quot;</span><span class="p">}</span> 
</pre></div>
</div>
<p>To list the owner’s pets run:</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span>$ curl -v http://127.0.0.1:8000/api/owner/{owner_id}/pets
</pre></div>
</div>
<p>for example:</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span>$ curl http://127.0.0.1:8000/api/owner/a05fd0df-0f97-4eec-a211-cad28a6e5360/pets
</pre></div>
</div>
<p>expected output:</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="p">[{</span><span class="s2">&quot;address&quot;</span><span class="p">:</span><span class="s2">&quot;home&quot;</span><span class="p">,</span><span class="s2">&quot;age&quot;</span><span class="p">:</span><span class="mi">57</span><span class="p">,</span><span class="s2">&quot;name&quot;</span><span class="p">:</span><span class="s2">&quot;tlmodylu&quot;</span><span class="p">,</span><span class="s2">&quot;owner_id&quot;</span><span class="p">:</span><span class="s2">&quot;a05fd0df-0f97-4eec-a211-cad28a6e5360&quot;</span><span class="p">,</span><span class="s2">&quot;pet_id&quot;</span><span class="p">:</span><span class="s2">&quot;a52adc4e-7cf4-47ca-b561-3ceec9382917&quot;</span><span class="p">,</span><span class="s2">&quot;weight&quot;</span><span class="p">:</span><span class="mi">5</span><span class="p">}]</span>
</pre></div>
</div>
<p>To list each specifc pet’s sensor:</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span>$ curl -v curl -v http://127.0.0.1:8000/api/pet/{pet_id}/sensors
</pre></div>
</div>
<p>for example:
i
$ curl http://127.0.0.1:8000/api/pet/cef72f58-fc78-4cae-92ae-fb3c3eed35c4/sensors</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="p">[{</span><span class="s2">&quot;pet_id&quot;</span><span class="p">:</span><span class="s2">&quot;cef72f58-fc78-4cae-92ae-fb3c3eed35c4&quot;</span><span class="p">,</span><span class="s2">&quot;sensor_id&quot;</span><span class="p">:</span><span class="s2">&quot;5a9da084-ea49-4ab1-b2f8-d3e3d9715e7d&quot;</span><span class="p">,</span><span class="s2">&quot;type&quot;</span><span class="p">:</span><span class="s2">&quot;L&quot;</span><span class="p">},{</span><span class="s2">&quot;pet_id&quot;</span><span class="p">:</span><span class="s2">&quot;cef72f58-fc78-4cae-92ae-fb3c3eed35c4&quot;</span><span class="p">,</span><span class="s2">&quot;sensor_id&quot;</span><span class="p">:</span><span class="s2">&quot;5c70cd8a-d9a6-416f-afd6-c99f90578d99&quot;</span><span class="p">,</span><span class="s2">&quot;type&quot;</span><span class="p">:</span><span class="s2">&quot;R&quot;</span><span class="p">},{</span><span class="s2">&quot;pet_id&quot;</span><span class="p">:</span><span class="s2">&quot;cef72f58-fc78-4cae-92ae-fb3c3eed35c4&quot;</span><span class="p">,</span><span class="s2">&quot;sensor_id&quot;</span><span class="p">:</span><span class="s2">&quot;fbefa67a-ceb1-4dcc-bbf1-c90d71176857&quot;</span><span class="p">,</span><span class="s2">&quot;type&quot;</span><span class="p">:</span><span class="s2">&quot;L&quot;</span><span class="p">}]</span>
</pre></div>
</div>
<p>To review the data from a specific sensor:</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span>$ curl http://127.0.0.1:8000/api/sensor/{sensor_id}/values?from=2006-01-02T15:04:05Z07:00&amp;to=2006-01-02T15:04:05Z07:00
</pre></div>
</div>
<p>for example:</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span>$  curl http://127.0.0.1:8000/api/sensor/5a9da084-ea49-4ab1-b2f8-d3e3d9715e7d/values\?from\=&quot;2020-08-06T00:00:00Z&quot;\&amp;to\=&quot;2020-08-06T23:59:59Z&quot;
</pre></div>
</div>
<p>expected output:</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="p">[</span><span class="mf">51.360596</span><span class="p">,</span><span class="mf">26.737432</span><span class="p">,</span><span class="mf">77.88015</span><span class="p">,</span><span class="o">...</span><span class="p">]</span>
</pre></div>
</div>
<p>To read the pet’s daily average per sensor use:</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span>$ curl http://127.0.0.1:8000/api/sensor/{sensor_id}/values/day/{date}
</pre></div>
</div>
<p>for example:</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span>$ curl -v http://127.0.0.1:8000/api/sensor/5a9da084-ea49-4ab1-b2f8-d3e3d9715e7d/values/day/2020-08-06
</pre></div>
</div>
<p>expected output:</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="p">[</span><span class="mi">0</span><span class="p">,</span><span class="mi">0</span><span class="p">,</span><span class="mi">0</span><span class="p">,</span><span class="mi">0</span><span class="p">,</span><span class="mi">0</span><span class="p">,</span><span class="mi">0</span><span class="p">,</span><span class="mi">0</span><span class="p">,</span><span class="mi">0</span><span class="p">,</span><span class="mi">0</span><span class="p">,</span><span class="mi">0</span><span class="p">,</span><span class="mi">0</span><span class="p">,</span><span class="mi">0</span><span class="p">,</span><span class="mi">0</span><span class="p">,</span><span class="mi">0</span><span class="p">,</span><span class="mf">42.55736</span><span class="p">]</span>
</pre></div>
</div>
</div>
<div class="section" id="code-structure-and-implementation">
<h2>Code Structure and Implementation<a class="headerlink" href="#code-structure-and-implementation" title="Permalink to this headline">¶</a></h2>
<p>The code package structure is as follows:</p>
<table border="1" class="docutils">
<thead>
<tr>
<th>Name</th>
<th>Purpose</th>
</tr>
</thead>
<tbody>
<tr>
<td>/api</td>
<td>swagger api spec</td>
</tr>
<tr>
<td>/cmd</td>
<td>applications executables</td>
</tr>
<tr>
<td>/cmd/migrate</td>
<td>install database schema</td>
</tr>
<tr>
<td>/cmd/sensor</td>
<td>Simulates the pet's collar</td>
</tr>
<tr>
<td>/cmd/server</td>
<td>web application backend</td>
</tr>
<tr>
<td>/config</td>
<td>database configuration</td>
</tr>
<tr>
<td>/db</td>
<td>database handlers (gocql/x)</td>
</tr>
<tr>
<td>/db/cql</td>
<td>database schema</td>
</tr>
<tr>
<td>/handler</td>
<td>swagger REST API handlers</td>
</tr>
<tr>
<td>/model</td>
<td>application models and ORM metadata</td>
</tr>
</tbody>
</table><p>After data is collected from the pets via the sensors on their collars, it is
delivered to the central database for analysis and for health status checking.</p>
<p>The collar code sits in the /cmd/sensor and uses scylladb/gocqlx Go driver to
connect to the database directly and publish its data. The collar sends a
sensor measurement update once a second.</p>
<p>Overall all applications in this repository use scylladb/gocqlx for:</p>
<ul class="simple">
<li><p>Relational Object Mapping (ORM)</p></li>
<li><p>Building Queries</p></li>
<li><p>Migrating database schemas</p></li>
</ul>
<p>The web application’s REST API server resides in /cmd/server and uses
go-swagger that supports OpenAPI 2.0 to expose its API. API handlers reside in
/handler. Most of the queries are reads.</p>
<p>The application is capable of caching sensor measurements data on an hourly
basis. It uses Lazy Evaluation to manage sensor_avg. It can be viewed as an
application-level lazy-evaluated materialized view.</p>
<p>The algorithm is simple and resides in /handler/avg.go:</p>
<ul class="simple">
<li><p>read sensor_avg</p></li>
<li><p>if there is no data, read measurement data, aggregate in memory, save</p></li>
<li><p>serve request</p></li>
</ul>
</div>
<div class="section" id="additional-resources">
<h2>Additional Resources<a class="headerlink" href="#additional-resources" title="Permalink to this headline">¶</a></h2>
<ul class="simple">
<li><p><a class="reference external" href="https://university.scylladb.com/courses/scylla-essentials-overview/">Scylla Essentials</a> course on Scylla University. It provides an introduction to Scylla and explains the basics</p></li>
<li><p><a class="reference external" href="https://university.scylladb.com/courses/data-modeling/">Data Modeling and Application Development</a> course on Scylla University. It explains basic and advanced data modeling techniques, including information on workflow application, query analysis, denormalization, and other NoSQL data modeling topics.</p></li>
<li><p><a class="reference external" href="https://docs.scylladb.com/">Scylla Documentation</a></p></li>
<li><p>Scylla users <a class="reference external" href="http://slack.scylladb.com/">slack channel</a></p></li>
</ul>
<p>Future Work</p>
<ul class="simple">
<li><p>Add Sizing</p></li>
<li><p>Add Benchmarking</p></li>
<li><p>Add Java implementation</p></li>
<li><p>Add Python implementation</p></li>
<li><p>In a real-world application, it would be better to aggregate data in an internal buffer and send it once a day to the application gateway in a batch, implying techniques such as delta encoding. It could also aggregate data at a lower resolution and take measurements less frequently. The collar could notify the pet’s owner about suspicious health parameters directly or via the application.</p></li>
<li><p>Add location tracking info to send alerts when the pet enters/leaves safe zones using known WiFi networks.</p></li>
<li><p>Use the measurements to present to the pet owner health alerts, vital signs, sleeping levels, activity levels, and calories burned.</p></li>
</ul>
</div>
</div>
  <div class="content-navigation">
  <div class="navigation navigation--prev">
  </div>
  <div class="navigation navigation--next">
    <a class="navigation__link" href="design_and_data_model.html">
      <div class="navigation__title">
        <span class="colored">NEXT</span> <br />Design and Data Model
      </div>
      <button class="navigation__button">
        <i class="scylla-icon scylla-icon--chevron-right"></i>
      </button>
    </a>
  </div>
</div> 
      </div>
      <div
        class="sidebar-left  large-order-1"
      > <div id="side-nav" class="side-nav" data-closable data-toggler=".show">
  <div class="side-nav__search">
    <div class="search-box">
      <ci-search></ci-search>
    </div>
  </div>
  <div class="side-nav__versions">
     <ul
  class="dropdown menu scylla-dropdown scylla-dropdown--versions scylla-dropdown--single-version"
  data-dropdown-menu
>
  <li class="scylla-dropdown__item">
    <a class="scylla-dropdown__title" href="#">
       master 
      <i class="chevron scylla-icon scylla-icon--chevron-right"></i>
    </a>
    <ul class="menu scylla-dropdown__content"> 
      <li>
        <a href="getting_started.html"
          >master</a
        >
      </li>
      
    </ul>
  </li>
</ul> 
  </div>
  <div class="side-nav__content">
    <ul class="current">
<li class="toctree-l1 current current-page"><a class="current reference internal" href="#">Getting Started with CarePet: A sample IoT App</a></li>
<li class="toctree-l1"><a class="reference internal" href="design_and_data_model.html">Design and Data Model</a></li>
<li class="toctree-l1"><a class="reference external" href="https://github.com/scylladb/care-pet">Care-Pet GitHub Repository</a></li>
<li class="toctree-l1"><a class="reference external" href="https://www.scylladb.com/2020/09/09/carepet-an-example-iot-use-case-for-hands-on-app-developers/">Care-Pet Blog</a></li>
</ul>

  </div>
</div>
      </div>
      
      <div class="sidebar-right large-order-3">
         <div class="secondary-side-nav">
  <div class="secondary-side-nav__content">
    <p class="topic-title">On this page</p>
    <ul>
<li><a class="reference internal" href="#">Getting Started with CarePet: A sample IoT App</a><ul>
<li><a class="reference internal" href="#introduction">Introduction</a></li>
<li><a class="reference internal" href="#use-case-requirements">Use Case Requirements</a></li>
<li><a class="reference internal" href="#performance-requirements">Performance Requirements</a></li>
<li><a class="reference internal" href="#design-and-data-model">Design and Data Model</a></li>
<li><a class="reference internal" href="#deploying-the-app">Deploying the App</a></li>
<li><a class="reference internal" href="#using-the-application">Using the Application</a></li>
<li><a class="reference internal" href="#code-structure-and-implementation">Code Structure and Implementation</a></li>
<li><a class="reference internal" href="#additional-resources">Additional Resources</a></li>
</ul>
</li>
</ul>

  </div>
</div> 
      </div>
    </section>

    <footer class="footer">
  <div class="footer-group">
    <div class="footer-top">
      <a class="footer-logo" href="https://www.scylladb.com"
        ><img
          src="_static/img/logo-scylla-horizontal-RGB.svg"
          alt="Logo"
      /></a>
      <div class="footer-links">
        <a class="footer-links__link" href="https://docs.scylladb.com/">Docs</a>
        <a
          class="footer-links__link"
          href="https://www.scylladb.com/company/contact-us/"
          >Contact Us</a
        >
        <a class="footer-links__link" href="https://www.scylladb.com/company/"
          >About Us</a
        >
      </div>
      <div class="footer-actions">
        <a
          class="footer-actions__link"
          href="https://groups.google.com/g/scylladb-users"
          target="_blank"
          ><span
            data-tooltip
            tabindex="1"
            title="User mailing list"
            data-position="bottom"
          >
            <img
              src="_static/img/icons/icon-mail-list.svg"
              alt="Mail List Icon"
            />
          </span>
        </a>
        <a
          class="footer-actions__link"
          href="http://slack.scylladb.com/"
          target="_blank"
          ><span
            data-tooltip
            tabindex="1"
            title="User Slack channel"
            data-position="bottom"
          >
            <img
              src="_static/img/icons/icon-slack.svg"
              alt="Slack Icon"
          /></span>
        </a>
      </div>
    </div>

    <div class="footer-bottom">
      <div class="footer-bottom__copyright"> &#169; 2021, ScyllaDB. All rights reserved.
      </div>
      <div class="footer-bottom__last-updated">
        Last updated on 30 September 2021.
      </div>
      <div class="footer-bottom__version">
        Powered by
        <a href="http://sphinx-doc.org/">Sphinx 2.4.4</a> &amp;
        <a href="https://sphinx-theme.scylladb.com/"
          >ScyllaDB Theme 1.0.4</a
        >
      </div>
    </div>
  </div>
</footer>

    <noscript>
      <iframe
        src="https://www.googletagmanager.com/ns.html?id=GTM-T8P2JP"
        height="0"
        width="0"
        style="display: none; visibility: hidden"
      ></iframe>
    </noscript>
  </body>
</html>